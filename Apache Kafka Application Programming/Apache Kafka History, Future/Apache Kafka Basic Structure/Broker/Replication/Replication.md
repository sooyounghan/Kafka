-----
### 복제 (Replication)
-----
<div align="center">
<img src="https://github.com/user-attachments/assets/088a53ff-4c20-4314-b8c8-d19fa815134e" />
</div>

1. 데이터 복제(Replication)
   - 카프카를 장애 허용 시스템(Fault Tolerant System)으로 동작하도록 하는 원동력
   - 복제의 이유는 클러스터로 묶인 브로커 중 일부에 장애가 발생하더라도 데이터를 유실하지 않고 안전하게 사용하기 위함
   - 카프카의 데이터 복제는 파티션 단위로 이루어짐
   - 토픽을 생성할 때 파티션의 복제 개수(Replication Factor)도 같이 설정 : 직접 옵션을 선택하지 않으면 브로커에 설정된 옵션 값을 따라감
     + 복제 개수의 최솟값은 1(복제 없음)이고, 최댓값은 브로커 개수만큼 설정하여 사용할 수 있음

<div align="center">
<img src="https://github.com/user-attachments/assets/3abe0a43-7789-4aca-82f8-18a8da360dd3" />
</div>

2. 복제된 파티션은 리더(Leader)와 팔로워(Follower)로 구성
   - 프로듀서 또는 컨슈머와 직접 통신하는 파티션을 리더, 나머지 복제 데이터를 가지고 있는 파티션을 팔로워라고 부름
   - 통상적으로 리더와 팔로워라고 부르지만, 파티션임을 명확하게 하기 위해 파티션의 리더를 '리더 파티션', 파티션의 팔로워를 '팔로워 파티션'이라고 지칭
   - 팔로워 파티션들은 리더 파티션의 오프셋을 확인해 현재 자신이 가지고 있는 오프셋과 차이가 나는 경우 리더 파티션으로부터 데이터를 가져와서 자신의 파티션에 저장하는데, 이 과정을 '복제'라고 부름

3. 파티션 복제로 인해 나머지 브로커에도 파티션의 데이터가 복제되므로, 복제 개수만큼 저장 용량이 증가하는 단점 존재
   - 그러나 복제를 통해 데이터를 안전하게 사용할 수 있다는 강력한 장점으로 카프카를 운영할 때 2 이상의 복제 개수를 정하는 것이 중요
   - 카프카 브로커가 설치된 기업용 서버는 개인용 컴퓨터와 비교가 안 될 정도로 안정성이 좋지만, 서버는 해커로 인한 침입 / 디스크 오류 / 네트워크 연결 장애 등 이유로 언제든 장애가 발생할 수 있음

4. 브로커에 장애가 발생한 경우
<div align="center">
<img src="https://github.com/user-attachments/assets/d1ae05cf-8281-40e7-9f26-3aab691b7c5c" />
</div>

   - 브로커가 다운되면 해당 브로커에 있는 리더 파티션은 사용할 수 없으므로 팔로워 파티션 중 하나가 리더 파티션의 지위를 넘겨 받음
   - 이를 통해 데이터가 유실되지 않고 컨슈머나 프로듀서와 데이터를 주고받도록 동작할 수 있음
   - 운영 시에는 데이터 종류마다 다른 복제 개수를 설정하고, 상황에 따라서는 토픽마다 복제 개수를 다르게 설정해 운영하기도 함
   - 데이터가 일부 유실되어도 무관하고 데이터 처리 속도가 중요하다면 1 또는 2로 설정
   - 금융 정보와 같이 유실이 일어나면 안 되는 데이터의 경우 복제 개수를 3으로 설정
